https://zhuanlan.zhihu.com/p/36981565

# 一、对称加密

数据交换双方，使用一个共享的秘钥，A发送数据前使用秘钥加密数据，B收到数据后，使用这个秘钥进行数据解密。

![image](https://pic2.zhimg.com/80/v2-334f01cb9b07c3a0b90eb048d011cfd5_720w.jpg)

1. 早期使用的秘钥长度是56bit（DES），是因为当时结合计算机的运行效率，要爆破56bit的秘钥是在可以接受的范围之内
2. 后来计算机运算效率提升，秘钥复杂度提升到了168bit（triple-DES），256bit（AES）
3. 但是对称加密还是需要数据交换双方先约定好秘钥，并且失效后要重新约定

# 二、非对称加密

![image](https://pic2.zhimg.com/80/v2-9db43298e5c55d26fd40367ba32f40ed_720w.jpg)
非对称加密是数据交换的双方，各自维护一对秘钥**public key和private key**，AB交换数据的时候：

1. A使用B的public key加密数据
2. B得到加密后的数据，使用自己的private key解密数据

public key和private key的特点：

1. 公钥和私钥一一对应
2. 公钥很难推算出私钥
3. 公钥和私钥是可以互解（公钥解密后的信息，私钥可以解开，反之同样成立）
4. 非对称加密算法：RSA，Elgamal，ECC

问题：

1. AB交换信息时，A要确认B收到的信息是完整，未经过改动的
2. B要确认这条信息是A发过来的，而不是别人发

这时引入了数字签名

# 三、数字签名

数字签名是**非对称加密算法**和**信息摘要算法**的结合体

信息摘要算法：

1. 无论输入的消息有多长，计算出来的消息摘要的长度总是固定的
2. 消息摘要看起来是“随机的”。
3. 信息摘要只能单向生成，无法反向生成源信息
4. 不同信息生成的摘要的碰撞率低，即摘要一致的情况极少
5. 即使数据源修改极少改动，但是生成的摘要变化会极大

数字签名原理：

1. AB交换信息
2. A把源数据通过摘要算法生成摘要得到（1）
3. 然后通过A的私钥加密（1）得到（2）
4. 然后把源数据使用B的公钥加密得到（3）
5. A 把（2）（3）传递给B
6. B把（2）使用A的公钥解密得到（1）
7. B把（3）使用B的私钥得到源数据
8. 然后使用摘要算法，生成摘要（4）
9. 对比（1）（4）是否一致，一致则承认结果

安全隐患：

1. AB传递中间，如果请求被C拦截，C则可以冒充AB，分别跟BA交互
2. 这里问题就在于AB的public key是公开的，我们需要找到验证public key的真实性的方法

# 四、CA（Certificate Authority）

CA是用来保证public key的真实性的，CA基于非对称算法。

工作原理：

1. A把自己的公钥给CA
2. CA用自己的私钥加密数据，生成A的数字证书
3. A这时传递公钥时就改为传递A的数字证书
4. B收到后，会通过CA发布的CA证书（CA的public key）解密B的数字证书，得到B的public key

特点：

1. CA把自己的CA证书集成在浏览器和操作系统中，无法在网络请求中篡改
2. 此时C拦截请求后，还是可以通过CA证书解密得出AB的公钥，但是C由于没有CA的私钥，因此无法伪造出一个可以通过CA认证的数字证书

实际使用：
实际中非对称加密效率很低，因此只用来交换对称的秘钥

# http over ssl

CA证书是需要收费的，普通人是不会进行CA认证，更多的是大的机构会去进行认证，此时ssl会这样工作：

1. 机构获取CA授权的数字证书后，把数字证书加到web服务器上
2. 用户向web服务器发起一个安全连接请求
3. 服务器返回经过CA忍者昂的数字证书，证书里面包含服务器的公钥
4. 用户拿到数字证书，用浏览器内置的CA证书解密得到服务器的公钥
5. 用户用服务器的公钥加密一个用于接下来的对称加密算法密钥，传给web 服务器
   1. 因为只有服务器有私钥解密
6. 服务器拿到这个加密密钥，解密获取密钥，在使用对称加密算法，和用户完成接下来的网络通信

![image](https://pic1.zhimg.com/80/v2-87bb34416d0824c204bb6a61172803db_720w.jpg)
